<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mcl – MÖBIUS 3 DOCUMENTATION</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9a880097239a4d302006afb9e90fa47b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">MÖBIUS 3 DOCUMENTATION</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../about.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://mobiuslooper.com/downloads/"> 
<span class="menu-text">DOWNLOADS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mobiuslooper.com/forum/public/"> 
<span class="menu-text">COMMUNITY</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../main/mcl.html">Main</a></li><li class="breadcrumb-item"><a href="../main/mcl.html">Sections</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Main</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/mcl.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Sections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/overlays.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parameter Layers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/sessions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Where are Sessions?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/synchronization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synchronization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/transport.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transport Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/upgrading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Upgrading Old Installations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../main/using-midi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuring MIDI Devices</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/upgrading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Upgrading Old Installations</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sections" id="toc-sections" class="nav-link active" data-scroll-target="#sections">Sections</a></li>
  <li><a href="#defining-sessions" id="toc-defining-sessions" class="nav-link" data-scroll-target="#defining-sessions">Defining Sessions</a></li>
  <li><a href="#configuring-sync-sources" id="toc-configuring-sync-sources" class="nav-link" data-scroll-target="#configuring-sync-sources">Configuring Sync Sources</a></li>
  <li><a href="#defining-overlays" id="toc-defining-overlays" class="nav-link" data-scroll-target="#defining-overlays">Defining Overlays</a></li>
  <li><a href="#defining-binding-sets" id="toc-defining-binding-sets" class="nav-link" data-scroll-target="#defining-binding-sets">Defining Binding Sets</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../main/mcl.html">Main</a></li><li class="breadcrumb-item"><a href="../main/mcl.html">Sections</a></li></ol></nav></header>




<p>+++ title = ‘The Mobius Configuration Language (MCL)’ draft = false +++</p>
<p><strong>MCL</strong> is a simple text language that can be used to quickly make complex configuration changes. You can use it as alternative to the UI for creating sessions, overlays, and bindings. It is not the same as the scripting language MSL.</p>
<p>MCL is written in text files and is executed using the menu item <strong>Run MCL Script</strong> item from the <strong>File</strong> menu. Unlike MSL you do not bind MCL scripts to MIDI or keyboard actions, it is only run from the menu, and each script is normally only run once.</p>
<section id="sections" class="level3">
<h3 class="anchored" data-anchor-id="sections">Sections</h3>
<p>An MCL script is line oriented, meaning that each line of the file contains a command. A file is origanized into one or more <em>sections</em> that begin with a <em>section heading</em> line. The section headings are:</p>
<ul>
<li>session</li>
<li>overlay</li>
<li>binding</li>
</ul>
</section>
<section id="defining-sessions" class="level3">
<h3 class="anchored" data-anchor-id="defining-sessions">Defining Sessions</h3>
<p>To create or modify a session, add a session section with a line similar to this:</p>
<pre><code>session MySession</code></pre>
<p>The word following the <em>session</em> keyword is the name of the session you want to create or modify. If the session name contains spaces, it must be surrounded with double quotes.</p>
<pre><code>session "My Session"</code></pre>
<p>You may also use the special name “active” which means you will modify whatever session is currently active in memory.</p>
<pre><code>session active</code></pre>
<p>If a session with the name you provide does not exist, a new session is created. If a session with that name already exists, it is modified. Creating or modifying a session does not <em>load</em> the session unless that session is already active.</p>
<p>After the “session” header line will be one or more parameter assignment lines of this form:</p>
<pre><code>&lt;parameter name&gt; &lt;value&gt;</code></pre>
<p>For example:</p>
<pre><code>quantize cycle
switchQuantize loop
inputPort 1
outputPort 2</code></pre>
<p>You may have any number of parameter assignment lines following the session header. Parameter assignments made immediately after the session header are the <em>default parameters</em>. These will be the values shared by all tracks unless those tracks override the default values.</p>
<p>If you want a track to have a different parameter value than the default, you add a <em>track header</em> line like this:</p>
<pre><code>track 2</code></pre>
<p>After the track header, you then put other parameter assignment lines, but these parameters only apply to track number 2. In this example, a session is created with the default input port of 1 but this is overridden in track 2 to use inport port number 3.</p>
<pre><code>session MySession
inputPort 1
track 2
inputPort 3</code></pre>
<p>To set parameter overrides for other tracks, just add more track header lines.</p>
<pre><code>track 3
inputPort 4
track 4
inputPort 5</code></pre>
<p>You can completely define all parameters for a session in this way, or you can just make changes to a few parameters. If a track currently has a parameter override that you would like to remove and have that track use the default parameter instead, use the special name “remove” as the parameter value.</p>
<pre><code>track 3
inputPort remove</code></pre>
<section id="track-scoped-lines" class="level4">
<h4 class="anchored" data-anchor-id="track-scoped-lines">Track Scoped Lines</h4>
<p>As an alternative to using the <strong>track</strong> subsection header to define track-specific parameters, you may also give each parameter assignment line a prefix. The prefix is a track number followed by a colon.</p>
<pre><code>4:inputPort 2</code></pre>
<p>The previous line sets the inputPort parameter to 2 in track 4. It is the same as writing this:</p>
<pre><code>track 4
inputPort 2</code></pre>
</section>
</section>
<section id="configuring-sync-sources" class="level3">
<h3 class="anchored" data-anchor-id="configuring-sync-sources">Configuring Sync Sources</h3>
<p>MCL can also be used to set parameters related to the synchronization sources. Since these are not related to tracks, they are set under the <em>session</em> header line.</p>
<pre><code>session MySession
transportTempo 90
transportBeatsPerBar 5
midiBeatsPerBar 3
hostBarOverride true
hostBeatsPerBar 6</code></pre>
<p>When assigning parameters, you will need to use their <em>internal names</em>. These are the same as the names you would use in an MSL or MOS script. They are usually the same as the names displayed in the UI except that spaces are removed, the first letter is in lowercase, and each word is capitalized. For example, in the UI, parameter names are displayed with spaces between words and capital letters on each word:</p>
<ul>
<li>Switch Quantize</li>
<li>Sync Source</li>
<li>Track Sync Unit</li>
</ul>
<p>The internal script names for those parameters is:</p>
<ul>
<li>switchQuantize</li>
<li>syncSource</li>
<li>trackSyncUnit</li>
</ul>
</section>
<section id="defining-overlays" class="level3">
<h3 class="anchored" data-anchor-id="defining-overlays">Defining Overlays</h3>
<p>You define overlays in the much the same way as you define sessions. The only difference is that the section header begins with <strong>overlay</strong> instead of <strong>session</strong>.</p>
<pre><code>overlay MyOverlay
quantize off
outputPort 5</code></pre>
</section>
<section id="defining-binding-sets" class="level3">
<h3 class="anchored" data-anchor-id="defining-binding-sets">Defining Binding Sets</h3>
<p>Using MCL can make entering a large number of MIDI or keyboard bindings much easier than using the UI. Bindings are created or modified within a <em>binding set</em> which has a name. To modify a binding set, create a bindings section in the MCL file using the section header “bindings” followed by the set name.</p>
<pre><code>bindings MyBindingSet</code></pre>
<p>If you are not using multiple binding sets, all bindings are stored in the standard binding set named “Base” that you may modify with this section header.</p>
<pre><code>bindings Base</code></pre>
<p>After the <em>bindings</em> section header are one or more lines that define the bindings you wish to create. Unlike parameter assignments, bindings are complex and consist of the following values.</p>
<ul>
<li>type (note, control, program, key)</li>
<li>channel (midi channel number from 1 to 16)</li>
<li>value (midi note number, cc number, program number, key code)</li>
<li>scope (track number or group name)</li>
<li>symbol (target function or parameter name)</li>
<li>arguments (arguments to a function)</li>
</ul>
<p>There are several ways to specify all of these values. The first is to use <em>keyword arguments</em> where each value is preceeded by the name of the value you are setting.</p>
<pre><code>type note channel 1 value 42 scope 2 symbol Record</code></pre>
<p>To reduce the amount of typing when creating a large number of bindings, you may specify a <em>column declaration</em> that tells the MCL reader what the values in each line mean:</p>
<pre><code>bindings Base
columns type channel value symbol
note 3 42 Record
note 3 44 Overdub</code></pre>
<p>This creates two bindings, one for the <em>Record</em> function which is bound to the MIDI note number 42 on channel 3, and one for the <em>Overdub</em> function which is bound to the note number 44 also on channel 3.</p>
<p>Since repeating the type and channel for MIDI bindings is common, they can be defaulted by specifying a <em>default declaration</em>.</p>
<pre><code>bindings Base
defaults type note channel 3
columns value symbol
42 Record
44 Overdub</code></pre>
<p>You can change the defaults and the columns any time within a binding section. If you wanted to start entering bindings for channel 4 instead, just add another <em>defaults</em> line.</p>
<pre><code>defaults channel 4
42 Multiply
44 Insert</code></pre>
<p>The most recent <em>columns</em> specification is still being used, and the default for <em>type</em> is still <em>note</em>, but the default <em>channel</em> is now 4 instead of 3.</p>
<p>You may also override the defaults on any binding line by using keyword arguments, but these must go after the values for the declared columns.</p>
<pre><code>defaults type note channel 3
columns value symbol
42 Record
42 Overdub channel 4</code></pre>
<p>Here the same note number 42 is used for both the <em>Record</em> and <em>Overdub</em> functions, but <em>Overdub</em> is bound to channel 4 instead of 3. It is the same as writing these lines, but saves one line of text.</p>
<pre><code>defaults type note channel 3
columns value symbol
42 Record
defaults channel 4
42 Overdub</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/SchrodingersCat-Mobius\.github\.io\/mobius3-doc\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>